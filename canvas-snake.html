<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            list-style: none;
        }
    </style>
</head>

<body>
    <canvas width="600px" height="600" id="canvas"></canvas>
    <script>
        const obj = document.getElementById('canvas').getContext('2d');
        const CANVAS_WIDTH = 600;
        const CANVAS_HEIGHT = 600;
        const MAP_WIDTG = 300;
        const LITTLE_CUBE_WIDTH = MAP_WIDTG / 10;
        let direction = 'right';
        const LOCATION = {
            x: 200,
            y: 200
        }

        let snake = [
            { x: 7, y: 7, isHead: true },
            { x: 6, y: 7 },
            { x: 6, y: 6 },
            { x: 5, y: 6 },
            { x: 5, y: 5 },
        ]
        let FOOD = {
            x: 0,
            y: 0
        }
        let timer = null;
        let isShow = false;
        let isPause = false;
        window.onload = function () {
            drawMap();
            keyBoardEvent();
            getFoodLocation();   
            gameClickPause();        
        }

        function drawRect(x, y, color) {
            obj.fillStyle = color;
            obj.fillRect(
                LOCATION.x + x * LITTLE_CUBE_WIDTH,
                LOCATION.y + y * LITTLE_CUBE_WIDTH,
                LITTLE_CUBE_WIDTH,
                LITTLE_CUBE_WIDTH);
        }
        function drawSnake(snake) {
            for (let i = 0; i < snake.length; i++) {
                drawRect(snake[i].x, snake[i].y, snake[i].isHead ? 'black' : 'red')
            }
        }
        function moveSnakeBody(snake) {
            for (let i = snake.length - 1; i > 0; i--) {
                snake[i].x = snake[i - 1].x;
                snake[i].y = snake[i - 1].y;
            }
        }
        function drawMap() {
            obj.beginPath();
            obj.strokeStyle = 'bule';
            obj.lineWidth = 5;
            obj.fillStyle = 'white';
            obj.fillRect(LOCATION.x, LOCATION.y, MAP_WIDTG, MAP_WIDTG);
            obj.strokeRect(
                LOCATION.x - (obj.lineWidth / 2),
                LOCATION.y - (obj.lineWidth / 2),
                MAP_WIDTG + obj.lineWidth,
                MAP_WIDTG + obj.lineWidth);
            obj.closePath();
        }
        function isFoodOnSnake() {
            return snake.some(snakeNode => snakeNode.x === FOOD.x && snakeNode.y === FOOD.y);
        }
        function getFoodLocation() {
            do {
                FOOD.x = Math.floor(Math.random() * 10);
                FOOD.y = Math.floor(Math.random() * 10);
            } while (isFoodOnSnake());
        }
        function drawFood() {
            isShow = !isShow;
            drawRect(FOOD.x, FOOD.y, isShow ? 'white' : 'red');
        }
        function clearMap() {
            obj.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        }
        function getHead() {
            return snake[0];
        }
        function keyBoardEvent() {
            document.onkeyup = function (e) {
                const ev = e || event;
                switch (ev.key) {
                    case 'ArrowRight':
                        direction != 'left' ? direction = 'right' : direction = direction;
                        break;
                    case 'ArrowLeft':
                        direction != 'right' ? direction = 'left' : direction = direction;
                        break;
                    case 'ArrowUp':
                        direction != 'down' ? direction = 'up' : direction = direction;
                        break;
                    case 'ArrowDown':
                        direction != 'up' ? direction = 'down' : direction = direction;
                        break;
                    case 'Enter' :
                        isPause = !isPause;
                        isPause ? gameStart() : gamePause();
                }
            }
        }
        function changeDirection(direction) {
            switch (direction) {
                case 'right':
                    moveRight();
                    break;
                case 'left':
                    moveLeft();
                    break;
                case 'up':
                    moveUp();
                    break;
                case 'down':
                    moveDown();
                    break;
            }
        }
        function moveRight() {
            const head = getHead(snake);
            head.x == 9 ? head.x = 0 : head.x += 1;
            head.y += 0;
        }
        function moveLeft() {
            const head = getHead(snake);
            head.x == 0 ? head.x = 9 : head.x -= 1;
            head.y += 0;
        }
        function moveUp() {
            const head = getHead(snake);
            head.y == 0 ? head.y = 9 : head.y -= 1;
            head.x += 0;
        }
        function moveDown() {
            const head = getHead(snake);
            head.y == 9 ? head.y = 0 : head.y += 1;
            head.x += 0;
        }
        function isEatFood() {
            const head = getHead(snake);
            const food = FOOD;
            return (head.x === food.x && head.y === food.y)
        }
        function foodPush() {
            let lastSnakeBody = snake[snake.length - 1];
            let secondLastSnakeBody = snake[snake.length - 2];
            let x = lastSnakeBody.x - secondLastSnakeBody.x;
            let y = lastSnakeBody.y - secondLastSnakeBody.y;
            let newBody = {
                x: lastSnakeBody.x + x,
                y: lastSnakeBody.y + y
            }
            snake.push(newBody)
            getFoodLocation();
        }
        function isEatSelf() {
            const head = getHead();
            for(let i = 1 ; i<snake.length; i++) {
                if(snake[i].x === head.x && snake[i].y === head.y){
                    return true;
                }
            }
            /*return snake.slice(1,snake.length).some(
                snakeNode => snakeNode.x === head.x && snakeNode.y === head.y
                );*/
        }
        function gameOver () {
            clearInterval(timer);
            alert(snake.length - 5);
            window.location.reload();
        }
        function gameStart() {
            clearInterval(timer);
            timer = setInterval( function(){
                clearMap();
                drawMap();
                drawFood();
                changeDirection(direction);
                isEatSelf() && gameOver();
                drawSnake(snake);
                moveSnakeBody(snake);
                isEatFood() && foodPush();
            }, 200);
        }
        function gamePause() {
            clearInterval(timer);
        }
        function gameClickPause() {
            window.onclick = function() {
                isPause = !isPause;
                isPause ? gameStart() : gamePause();
            }
        }
    </script>
</body>

</html>